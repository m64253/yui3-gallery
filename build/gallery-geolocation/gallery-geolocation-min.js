YUI.add("gallery-geolocation",function(E){if(!YUI.GEO_LOCATION_JSONP){YUI.GEO_LOCATION_JSONP=[];}var A=E.Lang,F,B,C,D;F=function(){var G=this;if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(H){G.success({latitude:H.coords.latitude,longitude:H.coords.longitude,provider:"W3C"});},function(H){B.call(G);});}else{B.call(this);}};B=function(){var H=this,G;if(window.google&&window.google.gears){G=window.google.gears.factory.create("beta.geolocation");if(G.hasPermission){G.getCurrentPosition(function(I){H.success({latitude:I.latitude,longitude:I.longitude,provider:"Gears"});},function(){C.call(H);});}else{C.call(this);}}else{C.call(this);}};C=function(){D("http://jsonip.appspot.com",null,function(G){if(G&&G.ip){D("http://query.yahooapis.com/v1/public/yql",{q:'SELECT * FROM geo.places WHERE woeid IN (SELECT place.woeid FROM flickr.places WHERE (lat,lon) in (SELECT Latitude, Longitude FROM ip.location WHERE ip = "'+G.ip+'"))',format:"json",env:"http://datatables.org/alltables.env"},function(H){if(!H.error&&H.query&&H.query.results&&H.query.results.place){this.success({latitude:H.query.results.place.centroid.latitude,longitude:H.query.results.place.centroid.longitude,provider:"IP"});}else{this.failure();}},this);}else{this.failure();}},this);};D=function(I,M,P,O){M=M||{};var K=document.createElement("script"),N=document.getElementsByTagName("head")[0],J=[],H,G,L=YUI.GEO_LOCATION_JSONP.length;YUI.GEO_LOCATION_JSONP[L]=function(Q){clearTimeout(H);N.removeChild(K);P.call(O,Q);YUI.GEO_LOCATION_JSONP[L]=function(){};};M.callback="YUI.GEO_LOCATION_JSONP["+L+"]";E.Object.each(M,function(R,Q){J.push(Q+"="+encodeURIComponent(R));});G=I+"?"+J.join("&");K.setAttribute("src",G);H=setTimeout(function(){N.removeChild(K);P.call(O);},30000);N.appendChild(K);};E.geolocation=function(G,I,H){F.call({success:function(J){if(A.isObject(J)&&A.isValue(J.latitude)&&A.isValue(J.latitude)){if(E.Lang.isFunction(G)){G.call(H,J);}}else{if(E.Lang.isFunction(I)){I.call(H);}}},failure:function(J){I.call(H);}});};},"@VERSION@");