YUI.add("gallery-geolocation",function(D){if(!YUI.GEO_LOCATION_JSONP){YUI.GEO_LOCATION_JSONP=[];}var A=D.Lang,E,B,C;E=function(G){var F=this;if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(H){F.success({latitude:H.coords.latitude,longitude:H.coords.longitude,provider:"W3C"});},function(H){if(!G){B.call(F);}else{F.failure();}});}else{if(!G){B.call(this);}else{this.failure();}}};B=function(H){var G=this,F;if(window.google&&google.gears&&A.isFunction(google.gears.factory.create)){F=google.gears.factory.create("beta.geolocation");if(F.hasPermission){F.getCurrentPosition(function(I){G.success({latitude:I.latitude,longitude:I.longitude,provider:"Gears"});},function(){if(!H){C.call(this);}else{this.failure();}});}else{if(!H){C.call(this);}else{this.failure();}}}else{if(!H){C.call(this);}else{this.failure();}}};C=function(){D.jsonp("http://jsonip.appspot.com",{on:{success:function(G){var F=new D.yql('SELECT * FROM geo.places WHERE woeid IN (SELECT place.woeid FROM flickr.places WHERE (lat,lon) in (SELECT Latitude, Longitude FROM ip.location WHERE ip = "'+G.ip+'"))');F.on("query",function(H){if(H.results&&H.results.place){this.success({latitude:H.results.place.centroid.latitude,longitude:H.results.place.centroid.longitude,provider:"IP"});}else{this.failure();}},this);F.on("error",this.failure,this);},failure:this.failure,timeout:this.failure},context:this});};D.geolocation=function(F,I,G,H){var J={success:function(K){if(A.isObject(K)&&A.isValue(K.latitude)&&A.isValue(K.latitude)){if(D.Lang.isFunction(F)){F.call(G,K);}}else{if(D.Lang.isFunction(I)){I.call(G);}}},failure:function(K){I.call(G);}};if(H==="w3c"){E.call(J,true);}else{if(H==="gears"){B.call(J,true);}else{if(H==="ip"){C.call(J);}else{E.call(J);}}}};},"@VERSION@",{requires:["gallery-jsonp","gallery-yql"]});